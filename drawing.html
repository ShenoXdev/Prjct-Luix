<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
Â  Â  <title>Luix's Endless Drawing</title>
Â  Â  <style>
Â  Â  Â  Â  html, body {
Â  Â  Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  Â  Â  padding: 0;
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  Â  Â  touch-action: none;
Â  Â  Â  Â  Â  Â  font-family: sans-serif;
Â  Â  Â  Â  Â  Â  background-color: #f0f0f0;
Â  Â  Â  Â  }
Â  Â  Â  Â  .top-menu, .bottom-menu {
Â  Â  Â  Â  Â  Â  position: fixed;
Â  Â  Â  Â  Â  Â  left: 0;
Â  Â  Â  Â  Â  Â  right: 0;
Â  Â  Â  Â  Â  Â  background-color: #cd00e3;
Â  Â  Â  Â  Â  Â  padding: 10px;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: space-between;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  z-index: 10;
Â  Â  Â  Â  }
Â  Â  Â  Â  .top-menu {
Â  Â  Â  Â  Â  Â  top: 0;
Â  Â  Â  Â  }
Â  Â  Â  Â  .bottom-menu {
Â  Â  Â  Â  Â  Â  bottom: 0;
Â  Â  Â  Â  }
Â  Â  Â  Â  .top-menu .button-group {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  gap: 10px;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  }
Â  Â  Â  Â  .top-menu .right-section, .top-menu .left-section {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  gap: 10px;
Â  Â  Â  Â  }
Â  Â  Â  Â  .top-menu .right-section {
Â  Â  Â  Â  Â  Â  order: 2;
Â  Â  Â  Â  }
Â  Â  Â  Â  .top-menu .left-section {
Â  Â  Â  Â  Â  Â  order: 1;
Â  Â  Â  Â  }
Â  Â  Â  Â  .top-menu .right-section .tool-button {
Â  Â  Â  Â  Â  Â  background-color: #e846ff;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  padding: 8px 15px;
Â  Â  Â  Â  Â  Â  border-radius: 20px;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  font-size: 14px;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  text-decoration: none;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  gap: 5px;
Â  Â  Â  Â  }
Â  Â  Â  Â  #logo-svg {
Â  Â  Â  Â  Â  Â  height: 40px;
Â  Â  Â  Â  Â  Â  fill: white;
Â  Â  Â  Â  }
Â  Â  Â  Â  .bottom-menu .left-section {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  padding-left: 20px;
Â  Â  Â  Â  }
Â  Â  Â  Â  .bottom-menu .left-section button {
Â  Â  Â  Â  Â  Â  background: none;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  font-size: 24px;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  padding: 0;
Â  Â  Â  Â  }
Â  Â  Â  Â  .bottom-menu .right-section button {
Â  Â  Â  Â  Â  Â  background-color: #e846ff;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  padding: 12px 20px;
Â  Â  Â  Â  Â  Â  border-radius: 20px;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  font-size: 14px;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  }
Â  Â  Â  Â  canvas {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  top: 60px;
Â  Â  Â  Â  Â  Â  left: 0;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  height: calc(100% - 120px);
Â  Â  Â  Â  Â  Â  background: white;
Â  Â  Â  Â  Â  Â  touch-action: none;
Â  Â  Â  Â  }
Â  Â  Â  Â  .zoom-info {
Â  Â  Â  Â  Â  Â  position: fixed;
Â  Â  Â  Â  Â  Â  bottom: 60px;
Â  Â  Â  Â  Â  Â  left: 10px;
Â  Â  Â  Â  Â  Â  background: rgba(0,0,0,0.5);
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  padding: 5px 10px;
Â  Â  Â  Â  Â  Â  border-radius: 5px;
Â  Â  Â  Â  Â  Â  font-size: 12px;
Â  Â  Â  Â  }
Â  Â  Â  Â  input[type="file"] {
Â  Â  Â  Â  Â  Â  display: none;
Â  Â  Â  Â  }
Â  Â  Â  Â  .side-panel {
Â  Â  Â  Â  Â  Â  position: fixed;
Â  Â  Â  Â  Â  Â  top: 60px;
Â  Â  Â  Â  Â  Â  right: -170px; /* Adjusted to be completely hidden on the right side */
Â  Â  Â  Â  Â  Â  width: 150px;
Â  Â  Â  Â  Â  Â  height: calc(100% - 120px);
Â  Â  Â  Â  Â  Â  background-color: #cd00e3;
Â  Â  Â  Â  Â  Â  z-index: 11;
Â  Â  Â  Â  Â  Â  transition: right 0.3s ease-in-out;
Â  Â  Â  Â  Â  Â  padding: 20px 10px;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  gap: 10px;
Â  Â  Â  Â  }
Â  Â  Â  Â  .side-panel.open {
Â  Â  Â  Â  Â  Â  right: 0;
Â  Â  Â  Â  }
Â  Â  Â  Â  .side-panel button {
Â  Â  Â  Â  Â  Â  background-color: #e846ff;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  padding: 10px 20px;
Â  Â  Â  Â  Â  Â  border-radius: 20px;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  font-size: 14px;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  box-sizing: border-box;
Â  Â  Â  Â  }
Â  Â  Â  Â  .color-input-container, .size-input-container {
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  Â  Â  display: inline-block;
Â  Â  Â  Â  }
Â  Â  Â  Â  .color-input-container input[type="color"],
Â  Â  Â  Â  .size-input-container input[type="number"] {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  top: 0;
Â  Â  Â  Â  Â  Â  right: 0;
Â  Â  Â  Â  Â  Â  opacity: 0;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body>

<div class="top-menu">
Â  Â  <div class="right-section">
Â  Â  Â  Â  <div class="button-group">
Â  Â  Â  Â  Â  Â  <div class="color-input-container">
Â  Â  Â  Â  Â  Â  Â  Â  <input type="color" id="colorPicker" value="#000000">
Â  Â  Â  Â  Â  Â  Â  Â  <button class="tool-button">ğŸ¨ Ø§Ù„Ù„ÙˆÙ†</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="size-input-container">
Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="brushSize" min="1" max="100" value="3" step="1">
Â  Â  Â  Â  Â  Â  Â  Â  <button class="tool-button">ğŸ–Œï¸ Ø§Ù„Ø­Ø¬Ù…</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>
Â  Â  <div class="left-section">
Â  Â  Â  Â  <a href="#">
Â  Â  Â  Â  Â  Â  <svg id="logo-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 206.276 109">
Â  Â  Â  Â  Â  Â  Â  Â  <g id="Group_1" data-name="Group 1" transform="translate(-16 -21)">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <g id="Rectangle_1" data-name="Rectangle 1" transform="translate(16 21)" fill="white" stroke="#e846ff" stroke-width="1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <rect width="30" height="109" rx="5" stroke="none"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <rect x="0.5" y="0.5" width="29" height="108" rx="4.5" fill="none"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </g>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <g id="Path_2" data-name="Path 2" transform="translate(75 49)" fill="white">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <path d="M 44 52.5 L 9 52.5 C 4.313079833984375 52.5 0.5 48.68692016601562 0.5 44 L 0.5 9 C 0.5 4.485292434692383 4.038429260253906 0.7813649773597717 8.487458229064941 0.5152738690376282 C 8.442087173461914 2.605597257614136 8.314802169799805 10.57339954376221 8.772190093994141 19.05171012878418 C 9.489359855651855 32.34571075439453 11.24147033691406 40.51564025878906 13.97984981536865 43.33457946777344 C 14.73106956481934 44.10789108276367 15.57026958465576 44.5 16.47414016723633 44.5 C 18.66972923278809 44.5 21.41645050048828 42.18362045288086 24.87125968933105 37.41849136352539 C 27.53119087219238 33.74972152709961 30.58935928344727 28.6405200958252 33.96081161499023 22.23282051086426 C 39.15440368652344 12.36199951171875 43.51874923706055 2.374166250228882 44.326416015625 0.5061835646629333 C 48.86270141601562 0.6782845854759216 52.5 4.422357559204102 52.5 9 L 52.5 44 C 52.5 48.68692016601562 48.68692016601562 52.5 44 52.5 Z" stroke="none"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <path d="M 44.64605712890625 1.025833129882812 C 43.55759811401367 3.529380798339844 39.35693740844727 13.05084609985352 34.40329742431641 22.46563911437988 C 31.02078056335449 28.89436912536621 27.9499397277832 34.02397918701172 25.27606010437012 37.71197891235352 C 23.66282081604004 39.93708801269531 22.16835975646973 41.66783142089844 20.83420944213867 42.85612106323242 C 19.21451950073242 44.29872894287109 17.788330078125 45 16.47414016723633 45 C 15.43001937866211 45 14.47014999389648 44.55688858032227 13.62120819091797 43.68296813964844 C 10.79621124267578 40.77487182617188 8.996791839599609 32.49678039550781 8.272911071777344 19.07863998413086 C 7.848670959472656 11.21461868286133 7.926422119140625 3.787933349609375 7.976398468017578 1.065174102783203 C 4.046863555908203 1.569316864013672 1 4.935569763183594 1 9 L 1 44 C 1 48.41120910644531 4.588790893554688 52 9 52 L 44 52 C 48.41120910644531 52 52 48.41120910644531 52 44 L 52 9 C 52 4.80633544921875 48.75621032714844 1.355953216552734 44.64605712890625 1.025833129882812 M 9 0 C 9 0 7.724140167236328 44 16.47414016723633 44 C 25.22414016723633 44 44 0 44 0 C 48.97055816650391 0 53 4.029441833496094 53 9 L 53 44 C 53 48.97055816650391 48.97055816650391 53 44 53 L 9 53 C 4.029441833496094 53 0 48.97055816650391 0 44 L 0 9 C 0 4.029441833496094 4.029441833496094 0 9 0 Z" stroke="none" fill="#e846ff"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </g>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <g id="Rectangle_2" data-name="Rectangle 2" transform="translate(135 21)" fill="white" stroke="#e846ff" stroke-width="1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <rect width="21" height="109" rx="10" stroke="none"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <rect x="0.5" y="0.5" width="20" height="108" rx="9.5" fill="none"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </g>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <g id="Path_4" data-name="Path 4" transform="translate(170.947 53.994) rotate(-34)" fill="white">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <path d="M 8 61.5 L 7 61.5 C 3.415889978408813 61.5 0.5 58.58411026000977 0.5 55 L 0.5 7 C 0.5 3.415889978408813 3.415889978408813 0.5 7 0.5 L 8 0.5 C 11.58411026000977 0.5 14.5 3.415889978408813 14.5 7 L 14.5 55 C 14.5 58.58411026000977 11.58411026000977 61.5 8 61.5 Z" stroke="none"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <path d="M 7 1 C 3.691590309143066 1 1 3.69158935546875 1 7 L 1 55 C 1 58.30841064453125 3.691590309143066 61 7 61 L 8 61 C 11.30840969085693 61 14 58.30841064453125 14 55 L 14 7 C 14 3.69158935546875 11.30840969085693 1 8 1 L 7 1 M 7 0 L 8 0 C 11.86598968505859 0 15 3.134010314941406 15 7 L 15 55 C 15 58.86598968505859 11.86598968505859 62 8 62 L 7 62 C 3.134010314941406 62 0 58.86598968505859 0 55 L 0 7 C 0 3.134010314941406 3.134010314941406 0 7 0 Z" stroke="none" fill="#e846ff"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </g>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <g id="Rectangle_4" data-name="Rectangle 4" transform="translate(211.67 49) rotate(45)" fill="white" stroke="#e846ff" stroke-width="1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <rect width="15" height="62" rx="7" stroke="none"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <rect x="0.5" y="0.5" width="14" height="61" rx="6.5" fill="none"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </g>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <g id="Path_3" data-name="Path 3" transform="translate(45 108)" fill="white">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <path d="M 39 21.49999618530273 L 6 21.49999618530273 C 2.967289924621582 21.49999618530273 0.5 19.03270721435547 0.5 15.99999618530273 L 0.5 -4.049997329711914 C 0.5686241984367371 -3.938495635986328 0.6374394297599792 -3.82504343986512 0.7022500038146973 -3.718193292617798 C 1.72107994556427 -2.038453340530396 3.260760068893433 0.4999966323375702 5.405210018157959 0.4999966323375702 L 39 0.4999966323375702 C 42.03271102905273 0.4999966323375702 44.5 2.967286586761475 44.5 5.999996662139893 L 44.5 15.99999618530273 C 44.5 19.03270721435547 42.03271102905273 21.49999618530273 39 21.49999618530273 Z" stroke="none"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <path d="M 1 -2.296527862548828 L 1 15.99999618530273 C 1 18.75700759887695 3.242988586425781 20.99999618530273 6 20.99999618530273 L 39 20.99999618530273 C 41.75701141357422 20.99999618530273 44 18.75700759887695 44 15.99999618530273 L 44 5.999996185302734 C 44 3.242986679077148 41.75701141357422 0.9999961853027344 39 0.9999961853027344 L 5.405208587646484 0.9999961853027344 C 3.471275329589844 0.9999961853027344 2.044700622558594 -0.7052974700927734 1 -2.296527862548828 M 0.1917915344238281 -5.217250823974609 C 0.7787246704101562 -5.217250823974609 2.678031921386719 -3.814697265625e-06 5.405208587646484 -3.814697265625e-06 L 39 -3.814697265625e-06 C 42.3137092590332 -3.814697265625e-06 45 2.686286926269531 45 5.999996185302734 L 45 15.99999618530273 C 45 19.31370544433594 42.3137092590332 21.99999618530273 39 21.99999618530273 L 6 21.99999618530273 C 2.686290740966797 21.99999618530273 0 19.31370544433594 0 15.99999618530273 L 0 -4.389293670654297 C 0 -4.975826263427734 0.06555938720703125 -5.217250823974609 0.1917915344238281 -5.217250823974609 Z" stroke="none" fill="#e846ff"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </g>
Â  Â  Â  Â  Â  Â  Â  Â  </g>
Â  Â  Â  Â  Â  Â  </svg>
Â  Â  Â  Â  </a>
Â  Â  </div>
</div>

<div class="bottom-menu">
Â  Â  <div class="right-section">
Â  Â  Â  Â  <button id="undoBtn">â†©ï¸ ØªØ±Ø§Ø¬Ø¹</button>
Â  Â  Â  Â  <button id="redoBtn">â†ªï¸ Ø¥Ø¹Ø§Ø¯Ø©</button>
Â  Â  </div>
Â  Â  <div class="left-section">
Â  Â  Â  Â  <button id="dotsBtn">â€¢â€¢â€¢</button>
Â  Â  </div>
</div>

<div class="side-panel" id="sidePanel">
Â  Â  <button id="saveJsonBtn">ğŸ“ Ø­ÙØ¸ JSON</button>
Â  Â  <button id="loadJsonBtn">ğŸ“‚ ÙØªØ­ JSON</button>
Â  Â  <button id="exportPngBtn">ğŸ–¼ï¸ ØªØµØ¯ÙŠØ± PNG</button>
Â  Â  <button id="clearBtn">ğŸ§¹ Ù…Ø³Ø­</button>
</div>

<canvas id="canvas"></canvas>
<div class="zoom-info" id="zoomInfo">Ø²ÙˆÙ…: 1x</div>

<input type="file" id="jsonFileInput" accept=".json">

<script>
Â  Â  const canvas = document.getElementById("canvas");
Â  Â  const ctx = canvas.getContext("2d");
Â  Â  const colorPicker = document.getElementById("colorPicker");
Â  Â  const brushSize = document.getElementById("brushSize");
Â  Â  const undoBtn = document.getElementById("undoBtn");
Â  Â  const redoBtn = document.getElementById("redoBtn");
Â  Â  const clearBtn = document.getElementById("clearBtn");
Â  Â  const saveJsonBtn = document.getElementById("saveJsonBtn");
Â  Â  const loadJsonBtn = document.getElementById("loadJsonBtn");
Â  Â  const exportPngBtn = document.getElementById("exportPngBtn");
Â  Â  const jsonFileInput = document.getElementById("jsonFileInput");
Â  Â  const zoomInfo = document.getElementById("zoomInfo");
Â  Â  const dotsBtn = document.getElementById("dotsBtn");
Â  Â  const sidePanel = document.getElementById("sidePanel");

Â  Â  let width = window.innerWidth;
Â  Â  let height = window.innerHeight - 120;
Â  Â  canvas.width = width;
Â  Â  canvas.height = height;

Â  Â  let paths = [];
Â  Â  let undonePaths = [];
Â  Â  let currentPath = null;
Â  Â  let drawing = false;
Â  Â  let hasMoved = false;
Â  Â  let lastX = 0;
Â  Â  let lastY = 0;

Â  Â  let zoom = 1;
Â  Â  let panX = 0;
Â  Â  let panY = 0;
Â  Â  let isZooming = false;
Â  Â  let lastTouchDist = 0;
Â  Â  let zoomEndTime = 0;
Â  Â  const ZOOM_COOLDOWN = 200;
Â  Â  const MIN_ZOOM = 1e-25;
Â  Â  const MAX_ZOOM = 1e25;

Â  Â  function updateZoomInfo() {
Â  Â  Â  Â  if (zoom < 0.0001 || zoom > 10000) {
Â  Â  Â  Â  Â  Â  zoomInfo.textContent = `Ø²ÙˆÙ…: ${zoom.toExponential(2)}x`;
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  zoomInfo.textContent = `Ø²ÙˆÙ…: ${zoom.toFixed(zoom >= 1 ? 2 : 8)}x`;
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function drawAll() {
Â  Â  Â  Â  ctx.setTransform(1, 0, 0, 1, 0, 0);
Â  Â  Â  Â  ctx.clearRect(0, 0, canvas.width, canvas.height);
Â  Â  Â  Â  ctx.setTransform(zoom, 0, 0, zoom, panX, panY);

Â  Â  Â  Â  for (let path of paths) {
Â  Â  Â  Â  Â  Â  ctx.strokeStyle = path.color;
Â  Â  Â  Â  Â  Â  ctx.lineWidth = path.size;
Â  Â  Â  Â  Â  Â  ctx.lineCap = "round";
Â  Â  Â  Â  Â  Â  ctx.lineJoin = "round";
Â  Â  Â  Â  Â  Â  ctx.beginPath();
Â  Â  Â  Â  Â  Â  for (let i = 0; i < path.points.length - 1; i++) {
Â  Â  Â  Â  Â  Â  Â  Â  ctx.moveTo(path.points[i].x, path.points[i].y);
Â  Â  Â  Â  Â  Â  Â  Â  ctx.lineTo(path.points[i + 1].x, path.points[i + 1].y);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  ctx.stroke();
Â  Â  Â  Â  }
Â  Â  Â  Â  updateZoomInfo();
Â  Â  }

Â  Â  function getCanvasPos(e) {
Â  Â  Â  Â  const rect = canvas.getBoundingClientRect();
Â  Â  Â  Â  return {
Â  Â  Â  Â  Â  Â  x: (e.clientX - rect.left - panX) / zoom,
Â  Â  Â  Â  Â  Â  y: (e.clientY - rect.top - panY) / zoom
Â  Â  Â  Â  };
Â  Â  }

Â  Â  function distance(t1, t2) {
Â  Â  Â  Â  return Math.hypot(t2.clientX - t1.clientX, t2.clientY - t1.clientY);
Â  Â  }

Â  Â  function zoomToPoint(pointX, pointY, newZoom) {
Â  Â  Â  Â  const canvasX = pointX * zoom + panX;
Â  Â  Â  Â  const canvasY = pointY * zoom + panY;
Â  Â  Â  Â  zoom = Math.max(MIN_ZOOM, Math.min(newZoom, MAX_ZOOM));
Â  Â  Â  Â  panX = canvasX - pointX * zoom;
Â  Â  Â  Â  panY = canvasY - pointY * zoom;
Â  Â  Â  Â  drawAll();
Â  Â  }
Â  Â Â 
Â  Â  // Toggle side panel
Â  Â  dotsBtn.addEventListener("click", (e) => {
Â  Â  Â  Â  e.stopPropagation();
Â  Â  Â  Â  sidePanel.classList.toggle('open');
Â  Â  });

Â  Â  // Close side panel when clicking outside
Â  Â  document.addEventListener("click", (e) => {
Â  Â  Â  Â  if (!sidePanel.contains(e.target) && !dotsBtn.contains(e.target) && sidePanel.classList.contains('open')) {
Â  Â  Â  Â  Â  Â  sidePanel.classList.remove('open');
Â  Â  Â  Â  }
Â  Â  });

Â  Â  // Touch events
Â  Â  canvas.addEventListener("touchstart", (e) => {
Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (e.touches.length === 2) {
Â  Â  Â  Â  Â  Â  isZooming = true;
Â  Â  Â  Â  Â  Â  lastTouchDist = distance(e.touches[0], e.touches[1]);
Â  Â  Â  Â  }
Â  Â  Â  Â  else if (e.touches.length === 1 && !isZooming && Date.now() - zoomEndTime > ZOOM_COOLDOWN) {
Â  Â  Â  Â  Â  Â  const pos = getCanvasPos(e.touches[0]);
Â  Â  Â  Â  Â  Â  lastX = pos.x;
Â  Â  Â  Â  Â  Â  lastY = pos.y;
Â  Â  Â  Â  Â  Â  currentPath = {
Â  Â  Â  Â  Â  Â  Â  Â  color: colorPicker.value,
Â  Â  Â  Â  Â  Â  Â  Â  size: parseFloat(brushSize.value),
Â  Â  Â  Â  Â  Â  Â  Â  points: []
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  drawing = true;
Â  Â  Â  Â  Â  Â  hasMoved = false;
Â  Â  Â  Â  }
Â  Â  });

Â  Â  canvas.addEventListener("touchmove", (e) => {
Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (isZooming && e.touches.length === 2) {
Â  Â  Â  Â  Â  Â  const newDist = distance(e.touches[0], e.touches[1]);
Â  Â  Â  Â  Â  Â  const center = {
Â  Â  Â  Â  Â  Â  Â  Â  x: (e.touches[0].clientX + e.touches[1].clientX) / 2,
Â  Â  Â  Â  Â  Â  Â  Â  y: (e.touches[0].clientY + e.touches[1].clientY) / 2
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  const point = {
Â  Â  Â  Â  Â  Â  Â  Â  x: (center.x - canvas.getBoundingClientRect().left - panX) / zoom,
Â  Â  Â  Â  Â  Â  Â  Â  y: (center.y - canvas.getBoundingClientRect().top - panY) / zoom
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  zoomToPoint(point.x, point.y, zoom * (newDist / lastTouchDist));
Â  Â  Â  Â  Â  Â  lastTouchDist = newDist;
Â  Â  Â  Â  }
Â  Â  Â  Â  else if (drawing && e.touches.length === 1 && !isZooming) {
Â  Â  Â  Â  Â  Â  const touch = e.touches[0];
Â  Â  Â  Â  Â  Â  const pos = getCanvasPos(touch);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const dx = pos.x - lastX;
Â  Â  Â  Â  Â  Â  const dy = pos.y - lastY;
Â  Â  Â  Â  Â  Â  const dist = Math.sqrt(dx * dx + dy * dy);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (dist > 0.5) {
Â  Â  Â  Â  Â  Â  Â  Â  if (!hasMoved) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentPath.points.push({x: lastX, y: lastY});
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  hasMoved = true;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  currentPath.points.push(pos);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  ctx.strokeStyle = currentPath.color;
Â  Â  Â  Â  Â  Â  Â  Â  ctx.lineWidth = currentPath.size;
Â  Â  Â  Â  Â  Â  Â  Â  ctx.lineCap = "round";
Â  Â  Â  Â  Â  Â  Â  Â  ctx.beginPath();
Â  Â  Â  Â  Â  Â  Â  Â  ctx.moveTo(lastX, lastY);
Â  Â  Â  Â  Â  Â  Â  Â  ctx.lineTo(pos.x, pos.y);
Â  Â  Â  Â  Â  Â  Â  Â  ctx.stroke();
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  lastX = pos.x;
Â  Â  Â  Â  Â  Â  Â  Â  lastY = pos.y;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  });

Â  Â  canvas.addEventListener("touchend", (e) => {
Â  Â  Â  Â  if (isZooming) {
Â  Â  Â  Â  Â  Â  isZooming = false;
Â  Â  Â  Â  Â  Â  zoomEndTime = Date.now();
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (drawing && hasMoved && currentPath.points.length > 1) {
Â  Â  Â  Â  Â  Â  paths.push(currentPath);
Â  Â  Â  Â  Â  Â  undonePaths = [];
Â  Â  Â  Â  }
Â  Â  Â  Â  drawing = false;
Â  Â  Â  Â  currentPath = null;
Â  Â  Â  Â  hasMoved = false;
Â  Â  });

Â  Â  // Mouse events (for desktop)
Â  Â  canvas.addEventListener("mousedown", (e) => {
Â  Â  Â  Â  if (e.button === 0 && Date.now() - zoomEndTime > ZOOM_COOLDOWN) {
Â  Â  Â  Â  Â  Â  const pos = getCanvasPos(e);
Â  Â  Â  Â  Â  Â  lastX = pos.x;
Â  Â  Â  Â  Â  Â  lastY = pos.y;
Â  Â  Â  Â  Â  Â  currentPath = {
Â  Â  Â  Â  Â  Â  Â  Â  color: colorPicker.value,
Â  Â  Â  Â  Â  Â  Â  Â  size: parseFloat(brushSize.value),
Â  Â  Â  Â  Â  Â  Â  Â  points: []
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  drawing = true;
Â  Â  Â  Â  Â  Â  hasMoved = false;
Â  Â  Â  Â  }
Â  Â  });

Â  Â  canvas.addEventListener("mousemove", (e) => {
Â  Â  Â  Â  if (drawing) {
Â  Â  Â  Â  Â  Â  const pos = getCanvasPos(e);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const dx = pos.x - lastX;
Â  Â  Â  Â  Â  Â  const dy = pos.y - lastY;
Â  Â  Â  Â  Â  Â  const dist = Math.sqrt(dx * dx + dy * dy);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (dist > 0.5) {
Â  Â  Â  Â  Â  Â  Â  Â  if (!hasMoved) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentPath.points.push({x: lastX, y: lastY});
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  hasMoved = true;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  currentPath.points.push(pos);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  ctx.strokeStyle = currentPath.color;
Â  Â  Â  Â  Â  Â  Â  Â  ctx.lineWidth = currentPath.size;
Â  Â  Â  Â  Â  Â  Â  Â  ctx.lineCap = "round";
Â  Â  Â  Â  Â  Â  Â  Â  ctx.beginPath();
Â  Â  Â  Â  Â  Â  Â  Â  ctx.moveTo(lastX, lastY);
Â  Â  Â  Â  Â  Â  Â  Â  ctx.lineTo(pos.x, pos.y);
Â  Â  Â  Â  Â  Â  Â  Â  ctx.stroke();
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  lastX = pos.x;
Â  Â  Â  Â  Â  Â  Â  Â  lastY = pos.y;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  });

Â  Â  canvas.addEventListener("mouseup", (e) => {
Â  Â  Â  Â  if (e.button === 0 && drawing && hasMoved && currentPath.points.length > 1) {
Â  Â  Â  Â  Â  Â  paths.push(currentPath);
Â  Â  Â  Â  Â  Â  undonePaths = [];
Â  Â  Â  Â  }
Â  Â  Â  Â  drawing = false;
Â  Â  Â  Â  currentPath = null;
Â  Â  Â  Â  hasMoved = false;
Â  Â  });

Â  Â  canvas.addEventListener("mouseleave", () => {
Â  Â  Â  Â  if (drawing && hasMoved && currentPath.points.length > 1) {
Â  Â  Â  Â  Â  Â  paths.push(currentPath);
Â  Â  Â  Â  Â  Â  undonePaths = [];
Â  Â  Â  Â  }
Â  Â  Â  Â  drawing = false;
Â  Â  Â  Â  currentPath = null;
Â  Â  Â  Â  hasMoved = false;
Â  Â  });

Â  Â  canvas.addEventListener("wheel", (e) => {
Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  const rect = canvas.getBoundingClientRect();
Â  Â  Â  Â  const cursorX = e.clientX - rect.left;
Â  Â  Â  Â  const cursorY = e.clientY - rect.top;

Â  Â  Â  Â  const canvasPointX = (cursorX - panX) / zoom;
Â  Â  Â  Â  const canvasPointY = (cursorY - panY) / zoom;
Â  Â  Â  Â Â 
Â  Â  Â  Â  const zoomDelta = e.deltaY > 0 ? 0.9 : 1.1;
Â  Â  Â  Â  const newZoom = zoom * zoomDelta;

Â  Â  Â  Â  zoomToPoint(canvasPointX, canvasPointY, newZoom);
Â  Â  });

Â  Â  // Button handlers
Â  Â  clearBtn.addEventListener("click", () => {
Â  Â  Â  Â  paths = [];
Â  Â  Â  Â  undonePaths = [];
Â  Â  Â  Â  zoom = 1;
Â  Â  Â  Â  panX = 0;
Â  Â  Â  Â  panY = 0;
Â  Â  Â  Â  drawAll();
Â  Â  Â  Â  sidePanel.classList.remove('open');
Â  Â  });

Â  Â  saveJsonBtn.addEventListener("click", () => {
Â  Â  Â  Â  const data = {
Â  Â  Â  Â  Â  Â  paths: paths,
Â  Â  Â  Â  Â  Â  zoom: zoom,
Â  Â  Â  Â  Â  Â  panX: panX,
Â  Â  Â  Â  Â  Â  panY: panY
Â  Â  Â  Â  };
Â  Â  Â  Â  const json = JSON.stringify(data);
Â  Â  Â  Â  const blob = new Blob([json], {type: "application/json"});
Â  Â  Â  Â  const url = URL.createObjectURL(blob);
Â  Â  Â  Â Â 
Â  Â  Â  Â  const link = document.createElement('a');
Â  Â  Â  Â  link.download = 'drawing.json';
Â  Â  Â  Â  link.href = url;
Â  Â  Â  Â  link.click();
Â  Â  Â  Â Â 
Â  Â  Â  Â  setTimeout(() => URL.revokeObjectURL(url), 100);
Â  Â  Â  Â  sidePanel.classList.remove('open');
Â  Â  });

Â  Â  loadJsonBtn.addEventListener("click", () => {
Â  Â  Â  Â  jsonFileInput.click();
Â  Â  Â  Â  sidePanel.classList.remove('open');
Â  Â  });

Â  Â  jsonFileInput.addEventListener("change", (e) => {
Â  Â  Â  Â  const file = e.target.files[0];
Â  Â  Â  Â  if (!file) return;
Â  Â  Â  Â Â 
Â  Â  Â  Â  const reader = new FileReader();
Â  Â  Â  Â  reader.onload = (event) => {
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const data = JSON.parse(event.target.result);
Â  Â  Â  Â  Â  Â  Â  Â  paths = data.paths || [];
Â  Â  Â  Â  Â  Â  Â  Â  zoom = data.zoom || 1;
Â  Â  Â  Â  Â  Â  Â  Â  panX = data.panX || 0;
Â  Â  Â  Â  Â  Â  Â  Â  panY = data.panY || 0;
Â  Â  Â  Â  Â  Â  Â  Â  undonePaths = [];
Â  Â  Â  Â  Â  Â  Â  Â  drawAll();
Â  Â  Â  Â  Â  Â  } catch (err) {
Â  Â  Â  Â  Â  Â  Â  Â  alert("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù: " + err.message);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };
Â  Â  Â  Â  reader.readAsText(file);
Â  Â  Â  Â  jsonFileInput.value = '';
Â  Â  });
Â  Â Â 
Â  Â  exportPngBtn.addEventListener("click", () => {
Â  Â  Â  Â  const link = document.createElement('a');
Â  Â  Â  Â  link.download = 'drawing.png';
Â  Â  Â  Â  link.href = canvas.toDataURL('image/png');
Â  Â  Â  Â  link.click();
Â  Â  Â  Â  sidePanel.classList.remove('open');
Â  Â  });

Â  Â  undoBtn.addEventListener("click", () => {
Â  Â  Â  Â  if (paths.length > 0) {
Â  Â  Â  Â  Â  Â  undonePaths.push(paths.pop());
Â  Â  Â  Â  Â  Â  drawAll();
Â  Â  Â  Â  }
Â  Â  });

Â  Â  redoBtn.addEventListener("click", () => {
Â  Â  Â  Â  if (undonePaths.length > 0) {
Â  Â  Â  Â  Â  Â  paths.push(undonePaths.pop());
Â  Â  Â  Â  Â  Â  drawAll();
Â  Â  Â  Â  }
Â  Â  });

Â  Â  window.addEventListener("resize", () => {
Â  Â  Â  Â  width = window.innerWidth;
Â  Â  Â  Â  height = window.innerHeight - 120;
Â  Â  Â  Â  canvas.width = width;
Â  Â  Â  Â  canvas.height = height;
Â  Â  Â  Â  drawAll();
Â  Â  });

Â  Â  drawAll();
</script>
</body>
</html>
